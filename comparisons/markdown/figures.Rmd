---
title: "manuscript_figures"
output: html_document
date: "2023-10-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(cowplot)
library(patchwork)
library(dmcdmfigs)
```

# **Putting Together Figures for Paper Manuscript**
These are, of course, subject to change but I mine as well start somewhere. The order of the figures will probably change as well as I figure out the story I want to tell with this manuscript. 


## **Figure One**
Plots to go in figure:
- experimental timeline diagram 
- mouse survival curve plot and stats

*Caption*:
*a) Survival curves for the five tested diets after antibiotic induced gut microbiome dysbiosis and C. difficile infection. b) A heat map of log-normal pairwise comparisons of survival probability between the tested diets. P-value significance (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).*

```{r, warning=FALSE, fig.height=12, fig.width=15}
fig1_bottom_row <- plot_grid(surv_stat_vis, NULL,
                             rel_widths = c(0.6, 1),
                             labels = c('b)', ' '),
                             label_size = 20)

plot_grid(diet_plot_final +
            theme_bw(base_size = 18),
          fig1_bottom_row,
          rel_heights = c(1, 0.5),
          nrow = 2,
          labels = c('a)', ' '),
          align = 'h',
          label_size = 20) -> fig1

fig1
```

## **Figure Two**
Plots to go in figure:
- cecal toxin plot 
- cecal overall histopathology plot
- cecal toxin/histo correlation plot (p-value significance should be overlaid)

*Caption*:
*a) C. difficile TcdA and TcdB toxin concentrations in the five tested diets, determined by ELISA. b) Histologic inflammation scoring of mouse cecal and colon contents at three days post C. difficile infection in the tested diets as determined by a blinded histologist. c) Linear regression comparison of C. difficile toxins TcdA/TcdB concentration to histologic inflammation scores. Statistical analysis was done using a Kruskal-Wallis test followed by a Dunn's Post Hoc test with p-values being corrected for multiple comparisons via Benjamini and Hochberg. P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).*
```{r, warning=FALSE, fig.height=12, fig.width=20}
fig2_top_row <- plot_grid(neat_plot +
                            theme_bw(base_size = 20) +
                            ylab('Concentration (ng/uL)') +
                            ggtitle('Cecum C. difficile Toxin Concentration'),
                          all_day_plot +
                            theme_bw(base_size = 20) +
                            ggtitle('Histopathology Scores') +
                            ylab('Score'),
                             labels = c('a)', 'b)'),
                             align = c('hv'),
                             axis = c('tblr'),
                             nrow = 1,
                            rel_widths = c(0.9, 1),
                             label_size = 20)

fig2_bottom_row <- plot_grid(neat_cecumHisto_stats_plot +
                               theme_bw(base_size = 20) +
                               theme(strip.text.y.right = element_text(angle = 0)) +
                               xlab('Concentration (ng/uL) (log10)'),
                            labels = c('c)'),
                            label_size = 20)
plot_grid(fig2_top_row,
          fig2_bottom_row,
          ncol = 1,
          align = c('hv'),
          axis = c('tblr'),
          rel_heights = c(1, 0.85)) -> fig2

fig2
```

## **Figure Three**
Plots to go in figure:
- overall hypoxia plot (location on x-axis)?
- cecum hypoxia plot (diet on x-axis)
- cecal hypoxia/histopathology correlation comparison plot (stats as supplementary since nothing is significant?)

*Caption*:
*a) Hypoxia measurements for three intestinal locations (cecum, proximal colon, distal colon) in the tested diets, determined by fluorescence of the oxygen sensitive dye, pimonidazole, in the respective tissues. b) Cecal hypoxia measurements between the five tested diets. Statistical analysis was done using a Kruskal-Wallis test followed by a Dunn's Post Hoc test with p-values being corrected for multiple comparisons via Benjamini and Hochberg. c) Linear regression comparison of cecal histologic inflammation scoring to hypoxia across tested diets. d) Linear regression comparison o colon histologic inflammation scoring to hypoxia across tested diets. P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).
```{r, warning=FALSE, fig.height=14, fig.width=23}
fig3_top_row <- plot_grid(hypox_plot +
                            theme_bw(base_size = 20) +
                            ggtitle('Intestinal Hypoxia') +
                            xlab('Location'),
                          hypox_cecumLocation_plot +
                            theme_bw(base_size = 20) +
                            ggtitle('Cecum Hypoxia Between Diets'),
                          labels = c('a)', 'b)'),
                          axis = c('tblr'),
                          align = c('hv'),
                          label_size = 20,
                          rel_widths = c(1, 0.4))


fig3_middle_row <- plot_grid(hypox_cecum_plot +
                               theme_bw(base_size = 20) +
                               theme(strip.text.y.right = element_text(angle = 0)),
                             hypox_colonStats_plot +
                               theme_bw(base_size = 20) +
                               theme(strip.text.y.right = element_text(angle = 0)),
                             labels = c('c)', 'd)'),
                             ncol = 1,
                             rel_heights = c(0.8, 1),
                             axis = c('tblr'),
                             align = c('hv'),
                             label_size = 20)

# fig3_bottom_row <- plot_grid(plotImageArray(test_rc$original_img), 
#                              plotImageArray(hypox_no_dam))

plot_grid(fig3_top_row,
          fig3_middle_row,
          rel_heights = c(0.95, 1),
          ncol = 1,
          align = c('hv'),
          axis = c('tblr')) -> fig3

fig3
```

## **Figure Four**
Plots to go in figure:
- bile acid concentration plot
- bile acid c. diff promoters/inhibitors ratio plot
- bile acid/toxin correlation comparison plots 
- metabolomics plot

*Caption*:
*a) Bile acid cecal levels of C. difficile growth inhibitors (a-MCA, b-MCA, LCA, DCA) and C. difficile growth promoters (TCA, CA) across the tested diets. b) The ratios of C. difficile growth promoters:inhibitors across the tested diets (a higher ratio indicates a higher level of promoters relative to inhibitors for that diet). Statistical analysis for dietary bile acid concentration/ratio differences was done using a Kruskal-Wallis test followed by a Dunn's Post Hoc test with p-values being corrected for multiple comparisons via Benjamini and Hochberg. Linear regression comparison of C. difficile toxins TcdA/TcdB concentration to c) C. difficile growth inhibitors and d) C. difficile growth promoters. e) SCFA (acetate, butyrate, propionate) levels of mouse cecal contents three days post C. difficile infecion by the tested diets. P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1)*
```{r, fig.height=12, fig.width=19}
fig4_top_row <- plot_grid(overall_plot +
                            theme_bw(base_size = 20)+
                            ggtitle('Cecum Bile Acid Concentration'), 
                          ratio_bile_plot +
                            theme_bw(base_size = 20)+
                            ggtitle('Cecum Bile Acid Ratio'),
                          labels = c('a)', 'b)'),
                          label_size = 20,
                          align = c('hv'),
                          axis = c('tblr'),
                          rel_widths = c(1, 0.7))

fig4_middle_row <- plot_grid(toxin_inhibitors_stats_plot +
                               theme_bw(base_size = 20) +
                               theme(strip.text.y.right = element_text(angle = 0)) +
                               ggtitle('Cecum C. difficile Toxin by Bile Acid Inhibitor Concentration'),
                             toxin_promoters_plot +
                               theme_bw(base_size = 20) +
                               theme(strip.text.y.right = element_text(angle = 0)) +
                               ggtitle('Cecum C. difficile Toxin by Bile Acid Promoter Concentration'),
                             ncol = 1,
                             labels = c('c)', 'd)'),
                             label_size = 20,
                             align = c('hv'),
                             axis = c('tblr'))


fig4_bottom_row <- plot_grid(metab_plot +
                               theme_bw(base_size = 20) +
                               ggtitle('Cecum SCFA Concentration'),
                             NULL,
                             rel_widths = c(1, 0.4),
                             nrow = 1,
                             labels = c('c)', ' '),
                             label_size = 20)

fig4 <- plot_grid(fig4_top_row,
                  fig4_bottom_row,
                  ncol = 1,
                  rel_heights = c(0.9, 0.8),
                  align = c('hv'),
                  axis = c('tblr'))

fig4
```

## **Figure Five**
Plots to go in figure:
- want to eventually have the plot that goes with 16S for stool and cecal samples 
- need an unbiased differential abundance test? 
- asv level of what things are influenced by diets 
- look for microbes that correlate with inflammation - use an ANCOMBC 
- filter low abundance asvs (anything that's in less than 20% of the samples)
**- have a distance matrix for every single mouse by their taxonomic information via qiime or r (which taxa are showing more related patterns by diet in mice). then, run an adonis test on it.**

*Caption*:
*a) Relative abundances of key gut bacterial families by the five tested diets throughout the experimental timeline. The dashed red line at day negative three indicates the day the mice received oral antibiotics and the purple dashed line at day zero indicates with the mice were infected with C. difficile. b) Pairwise comparisons by days relative to infection (columns) and bacterial family (rows) per diet as determined by a Kruskal-Wallis test followed by a Dunn's Post Hoc test with the color gradient indicating the difference in means.*P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).*
```{r, warning=FALSE, fig.height=15, fig.width=35}
plot_grid(short_abun1, stat_plot1,
          labels = c('a)', 'b)'),
          label_size = 20,
          rel_widths = c(1, 0.9)) -> fig5

fig5
```

## **Figure Six**

*Caption*:
*a) Unweighted UniFrac PCoA plots delimited by diet (columns) and by days relative to infection (rows). Individual points are colored by their associated Faith's PD score. b) Microbiome resilience determined using pairwise comparisons between day negative eight (seven days post diet switch and five days prior to oral antibiotic administration) and later time points. c) Microbiome homogeneity determined using pairwise Unweighted UniFrac distances within each time point by tested diets. The dashed red line at day negative three indicates the day the mice received oral antibiotics and the purple dashed line at day zero indicates with the mice were infected with C. difficile. Statistical analysis of microbiome d) resiliency and e) homogeneity was done with a Kruskal-Wallis test followed by a Dunn's Post Hoc test with the color gradient indicating the difference in means between the various groups.*P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).*
```{r, warning=FALSE, fig.width=26.5, fig.height=18}
## use NULL to create a ghost plot to alter your rows
fig6_bottom_row <- plot_grid(uu_resil_plot, uu_homog_plot,
                             uu_resil_stat_vis +
                               theme(legend.position = "None"), 
                             uu_homog_stat_vis,
                             nrow = 2,
                             rel_heights = c(1, 0.7),
                             rel_widths = c(0.90, 1),
                             labels = c('b)', 'c)', 'd)', 'e)'),
                             label_size = 20)


## this is for the stat table that isn't currently included in the plot 
unweighted_by_day <- na.omit(unweighted_by_day)

my_table_theme <- gridExtra::ttheme_default(core=list(bg_params = list(fill = 'white', col=NULL)))
unweighted_top <- unweighted_pcoa + gridExtra::tableGrob(unweighted_by_day,
                                                     rows = NULL, 
                                                     theme = my_table_theme)
                    
fig6_top_row <- plot_grid(unweighted_pcoa,
                          NULL,
                          nrow = 1,
                          rel_widths = c(1, 0.5),
                          labels = c('a)', ' '),
                          label_size = 20,
                          align = c('hv'),
                          axis = c('tblr'))

plot_grid(fig6_top_row,
          fig6_bottom_row,
          nrow = 2,
          rel_heights = c(0.9, 1)) -> fig6

fig6
```

## **Figure Seven**
Plots to go in figure:
- faith's pd and stats

*Caption*:
*a) Faith's Phylogenetic Diversity (alpha diversity) analysis by the five tested diets. The dashed red line at day negative three indicates the day the mice received oral antibiotics and the purple dashed line at day zero indicates with the mice were infected with C. difficile. b) Pairwise comparisons between diets as determined by a Kruskal-Wallis test followed by a Dunn's Post Hoc test with the color gradient indicating the difference in means.*P-value significance* (****p<0.0001, ***p<0.001, **p<0.01, *p<0.05, ns<1).*
```{r, warning=FALSE, fig.height=9, fig.width=15}
plot_grid(faith_plot +
            theme_bw(base_size = 20), 
          faith_stat_vis,
          ncol = 1,
          rel_heights = c(1, 0.7),
          labels = c('a)', 'b)'),
          align = 'h',
          label_size = 20) -> fig7

fig7
```


**Saving my Outputs**
as a .pdf and not an rdata object (just to clarify)
```{r}
ggsave('../../figures/fig1.pdf',
       plot = fig1,
       width = 15,
       height = 12)
ggsave('../../figures/fig2.pdf',
       plot = fig2,
       width = 20,
       height = 12)
ggsave('../../figures/fig3.pdf',
       plot = fig3,
       width = 23,
       height = 14)
ggsave('../../figures/fig4.pdf',
       plot = fig4,
       width = 19,
       height = 12)
ggsave('../../figures/fig5.pdf',
       plot = fig5,
       width = 35,
       height = 15)
ggsave('../../figures/fig6.pdf',
       plot = fig6,
       width = 26.5,
       height = 18)
ggsave('../../figures/fig7.pdf',
       plot = fig7,
       width = 15,
       height = 9)
```

